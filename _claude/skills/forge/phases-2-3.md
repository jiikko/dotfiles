# Phase 2〜3: 実装・セルフレビュー

## Phase 2: 実装 + ビルド確認（実装モードのみ）

Phase 1 の調査結果と Phase 1.5 の設計書に基づき、実装を行う。

### 実装手順

1. **類似コードを開く**: Explore で特定した類似コードを Read で読み込む
2. **パターンを踏襲**: 類似コードの命名規則、構造、エラーハンドリングを参考にする
3. **段階的に実装**: 設計書のステップに従って順番に実装
4. **都度ビルド確認**: 変更後は `make build` で即座に確認

### 実装時のチェックリスト

```markdown
□ CLAUDE.md のルールに準拠
  - 強制アンラップ禁止
  - canvases[0] 等の直接アクセス禁止
  - @State は private
  - メインスレッド制約を遵守

□ 類似コードとの一貫性
  - 命名規則を合わせる
  - ファイル配置を合わせる
  - エラーハンドリング方式を合わせる

□ モデル変更時の追加タスク（該当する場合）
  - ラウンドトリップテストの更新
  - docs/elements.md の更新
  - docs/api-design.md の更新
```

### ビルド確認（必須）

```bash
# 実装後、必ず実行
make build
```

**ビルドが失敗した場合**: エラーを修正してから次に進む。ビルドが通らない状態で Phase 3 に進まない。

### 実装中の専門家相談（難所で活用）

| 詰まった内容 | 呼び出すエージェント |
|-------------|---------------------|
| actor/async の設計 | swift-concurrency-expert |
| View の再描画問題 | swiftui-performance-expert |
| 設計・責務分離の判断 | architecture-reviewer |
| AppKit 統合の問題 | appkit-swiftui-integration-expert |
| テストの書き方 | swiftui-test-expert |
| エラーの原因特定 | debugger |

---

## Phase 3: セルフレビュー（実装モードのみ）

実装完了後、以下の観点でセルフレビューを実施する（回数はモード設定に従う）。

### セルフレビュー 1回目: 要件充足

```markdown
チェック項目:
- [ ] Phase 0 で確認した要件をすべて満たしているか
- [ ] 設計書の「期待される結果」を達成しているか
- [ ] エッジケースを考慮しているか
```

### セルフレビュー 2回目: 正確性

```markdown
チェック項目:
- [ ] ロジックは正しいか
- [ ] エラーハンドリングは適切か
- [ ] nil/optional の扱いは安全か
- [ ] 境界値は正しく処理されているか
```

### セルフレビュー 3回目: 類似コードとの一貫性

```markdown
チェック項目:
- [ ] Phase 1 で特定した類似コードと同じパターンを使っているか
- [ ] 命名規則は既存コードと一致しているか
- [ ] ファイル配置は適切か
```

### セルフレビュー 4回目: 品質

```markdown
チェック項目:
- [ ] コードは読みやすいか
- [ ] 重複コードはないか
- [ ] 単一責任原則を守っているか
- [ ] 過剰な実装（YAGNI違反）はないか
```

### セルフレビュー 5回目: プロジェクトルール + ビルド・テスト

```markdown
チェック項目:
- [ ] CLAUDE.md のルールに違反していないか
- [ ] SwiftLint エラー/警告はないか
```

**必須コマンド実行**:
```bash
make lint   # SwiftLint チェック
make build  # ビルド確認
make test   # テスト実行
```

**すべて通過してから** Phase 4 に進む。失敗した場合はその場で修正。
