# Phase 4.3: 反復並列思考（Ultra モードのみ）

Ultra モード選択時は、Phase 4.1/4.2 の代わりにこのフェーズを実行する。

## フロー

```
Round 1: 全エージェント並行実行（Phase 4 と同じ）
  → 各エージェントが独立して分析 → 結果を収集

Round 2: 再分析（全員の Round 1 結果を入力）
  → 同じエージェントを再度並行起動
  → 他エージェントの発見を踏まえて再分析

収束判定:
  → 新しい発見がある？ → Round 3 へ
  → 新しい発見がない or 最大ラウンド数 → 統合へ

統合: 全ラウンドの結果を統合エージェントがまとめる
```

## Round 2+ の再分析プロンプト

```
以下は他の専門家エージェントの分析結果（Round [N-1]）です。
これらを踏まえて、あなたの専門領域から**再分析**してください。

【他エージェントの分析結果】
[全エージェントの前ラウンド出力]

【あなたの前ラウンド分析】
[このエージェントの前ラウンド出力]

【再分析の観点】
1. **新たな発見**: 他エージェントの指摘を受けて気づいた新しい問題
2. **見解の変化**: 前ラウンドの自分の分析で修正すべき点
3. **深掘り**: 他エージェントの指摘をさらに深掘りした分析
4. **仮説の検証**: 他エージェントの仮説に対する検証結果
5. **合意事項**: 全員が同意している点の確認

【出力形式】
## Round [N] 再分析結果

### 🆕 新たな発見
[他エージェントの指摘を受けて気づいた点]

### 🔄 見解の更新
[前ラウンドからの変更点]

### 🔍 深掘り分析
[他エージェントの指摘をさらに発展させた分析]

### ✅ 合意事項
[全エージェントで一致している点]

### ❓ 未解決の疑問
[さらに調査が必要な点]
```

## 収束判定

各ラウンド終了後、以下の条件で収束を判定：

| 条件 | 判定 |
|------|------|
| 全エージェントから「新たな発見なし」 | **収束** |
| 「合意事項」が全エージェントで一致 | **収束** |
| 最大ラウンド数（3回）に到達 | **強制終了** |
| 「未解決の疑問」が減少傾向 | 継続を検討 |
| 「未解決の疑問」が増加傾向 | 1ラウンド追加して終了 |

## 統合プロンプト（Ultra モード用）

```
以下は全 [N] ラウンドにわたる反復分析の結果です。
これらを統合し、最終的な分析結果を作成してください。

【全ラウンドの結果】
[Round 1 〜 Round N の全出力]

【統合ルール】
1. ラウンドを重ねて収束した結論を優先
2. 複数エージェントが同意した指摘を高優先度に
3. 最終ラウンドで「未解決」とされた点は「要追加調査」として記録
4. 仮説の変遷（どう深まったか）を記録

【出力形式】
## Ultra モード統合結果

### 🎯 確定した根本原因
[全エージェントが合意した原因]

### 📊 分析の変遷
| ラウンド | 主要な発見 | 変化点 |
|---------|-----------|--------|
| Round 1 | [初期仮説] | - |
| Round 2 | [深掘り結果] | [何が変わったか] |
| Round 3 | [最終結論] | [収束した点] |

### 🔴 High Priority 対応
[修正すべき点]

### ❓ 追加調査が必要
[未解決の疑問]

### 💡 副次的な発見
[当初のタスク以外で発見された問題]
```
