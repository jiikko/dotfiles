#!/usr/bin/env bash

pane_id="$1"
cmd="$2"
pane_count="$3"

# Lookup AI-provided name (from @ai_name pane option) if available
ai_name="$(tmux display-message -p -t "$pane_id" '#{@ai_name}' 2>/dev/null | tr -d '\n')"

trim() { echo "$1" | awk '{$1=$1};1'; }
cmd_word=$(trim "$cmd" | awk '{print $1}')
cmd_lc=$(echo "$cmd_word" | tr 'A-Z' 'a-z')

# Icon map (Nerd Font)
icon="ï’‰"   # default: terminal
case "$cmd_lc" in
  nvim|vim) icon="î˜«" ;;  # nf-seti-vim
  node) icon="îœ˜" ;;      # nf-dev-nodejs_small
  deno) icon="îŸ€" ;;
  python|python3) icon="îœ¼" ;;
  ruby) icon="îœ¹" ;;
  go) icon="î˜§" ;;
  rustc|cargo) icon="îž¨" ;;
  git) icon="îœ‚" ;;
  ssh|mosh) icon="ï —" ;;
  docker|dockerd) icon="ïŒˆ" ;;
  tmux) icon="î¯ˆ" ;;
  top|htop|btop|btm) icon="ï‚€" ;;
  make|cmake|ninja) icon="ó°™¨" ;;
  yarn|pnpm|npm) icon="ó°›¦" ;;
  claude|claude-code|codex|gemini) icon="ðŸ¤–" ;;
  *) ;; # keep default
esac

name="${cmd_word:-shell}"
if [[ -n "$ai_name" ]]; then
  name="$ai_name"
  # keep icon if AI name already has emoji; else use robot
  if [[ "$name" != *[![:ascii:]]* && "$icon" != "ðŸ¤–" ]]; then
    icon="ðŸ¤–"
  fi
fi

if [[ -n "$pane_count" && "$pane_count" -gt 1 ]]; then
  echo "$icon $name [$pane_count]"
else
  echo "$icon $name"
fi
